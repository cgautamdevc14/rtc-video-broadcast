<html>
<head>
  <script src="camerainc/mjpeg.js"></script>
  <script src="camerainc/simplepeer.min.js"></script>
<script>
     
  function start(){
    var player = new MJPEG.Player("player", "http://127.0.0.1:1234/stream");
    player.start();
      streamToVideoElement() 
     setTimeout( 'setInterval("forever()", 1000)', 4000);
     }
    function forever(){
      if(canvas = document.querySelector("canvas").toDataURL().length< 2000){
      //  window.location.reload();
      start();
      }
    }
   function streamToVideoElement(){
    setTimeout(function(){
      var canvas = document.querySelector('canvas');
      var stream = canvas.captureStream(20);

    //  var video1 = document.querySelector('video:nth-of-type(1)');
    //  video1.style.display = "block"
    //  video1.srcObject = stream;
      gotMedia(stream);
  //    var video2 = document.querySelector('video:nth-of-type(2)');
  //    video2.srcObject = stream;
   //   setTimeout(function(){canvas.style.display = "none"}, 1000);
    }, 5000);
   }
    var data77;

function gotMedia (stream) {
  var peer1 = new SimplePeer({ initiator: true, stream: stream })
  var peer2 = new SimplePeer({stream:stream})

  peer1.on('signal', data => {
    peer2.signal(data)
  })

  peer2.on('signal', data => {
    peer1.signal(data)
  })

  peer2.on('stream', stream => {
    // got remote video stream, now let's show it in a video tag
    var video = document.querySelector('video')

    if ('srcObject' in video) {
      video.srcObject = stream
    } else {
      video.src = window.URL.createObjectURL(stream) // for older browsers
    }

    video.play()
  })
}

</script>
</head>
<body onload='start()'>
    <canvas id="player" style="background: #0000;" height=1200 width=1600>
      Your browser sucks.
    </canvas>
<video></video>
<video></video>
</body>
</html>

